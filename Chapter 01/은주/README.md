# Chapter 1. 앱에서 모호한 부분 밝히기
## 1.1. 앱을 더 쉽게 이해하는 방법
- 코드 조사 : 소프트웨어 기능의 특정한 동작을 분석하는 프로세스
- 디버깅 : 어떤 문제를 콕 집어 조사하는 것뿐만 아니라, 코드가 어떻게 작동하는지 정확하게 이해하는 행위
- 코드 조사는 소프트웨어 문제를 찾아내는 것뿐만 아니라, 구조가 복잡한 요즘 앱의 작동 방식을 이해하거나 새로운 기술을 배우기 위한 목적도 있다
- 개발자는 버그를 조치할 때 소프트웨어 기능을 이해하는 데 많은 시간을 쏟는다
- 사후 조사 : 앱 크래시 (앱이 갑자기 중단되거나 비정상 종료되는 경우) 직후 수집한 데이터를 살펴보는 것
  - 사후 조사는 로그, 힙 덤프, 스레드 덤프 등의 트러블 슈팅 도구를 사용하여 수행한다

## 1.2. 일반적인 코드 조사 시나리오
- 어떤 코드나 소프트웨어 기능이 **예상했던 것과 다른 결과를 낼 때**
- 디펜던시로 사용하는 **기술이 어떻게 작동되는지 이해하고 싶을 때**
- 앱 속도 저하 같은 **성능이슈가 불거진 원인을 파악**할 때
- **앱이 갑자기 중단된 원인**을 찾을 때

### 1.2.1. 예상과 다른 아웃풋의 원인을 밝힌다
#### 시나리오 1: 단순 케이스
- **디버거가 주어진 코드 라인에서 앱 실행을 멈추도록 브레이크 포인트를 추가**하고, 그 이후에는 수동 실행을 재개할 수 있다

#### 시나리오 2: 어디서부터 디버깅을 시작해야 할까?
- 때로는 어느 부분을 디버깅해야 할지 몰라 디버거를 사용할 수 없을 때도 있다.
- 이러한 경우, **프로파일러로 브레이크포인트를 추가할 만한 코드 라인의 스코프를 좁혀가야 한다.**
  - 프로파일러 : 앱이 실행되는 동안 어떤 코드가 실행되는지 식별하는 도구
  
#### 시나리오 3: 멀티스레드 앱
- 멀티스레드 아키텍처는 간섭에 민감한 편이어서 디버거를 사용할 수 없는 경우가 많다
  - 즉, **멀티스레드 앱이 실행될 때 디버거가 간섭을 일으키면, 디버거를 사용하는 시점마다 앱이 다르게 작동할 수 있다**는 말이다
  - 이러한 변화가 일어나면 조사하려는 앱의 동작을 처음부터 정확하게 조사하기 어렵다

#### 시나리오 4: 주어진 서비스에 잘못된 호출 보내기
- 다른 시스템의 컴포넌트나 외부 시스템과 올바르게 상호작용하지 못하는 시나리오도 있다
  - 앱이 잘못된 데이터가 포함된 HTTP 요청을 타 시스템 컴포넌트에 보내는 이유를 조사해야 한다.
- 앱이 요청을 주고받는 위치를 특정하기 곤란한 경우, 다른 앱 (상대방의 앱) 을 `스텁` 으로 바꾸는 것이다
  - 스텁 : 문제를 식별하기 위한 방향으로 제어할 수 있는 가짜 앱
  - ex. 스텁으로 요청을 차단시켜 앱이 응답을 무한 대기하도록 만들면, 코드의 어느 부분이 요청을 보내는지 알 수 있다. 그 후에 **프로파일러로 어느 코드가 스텁 때문에 막혀 있는지 찾아보는 것**이다.

### 1.2.2. 특정 기술을 습득한다
- 코드 분석하는 조사 기법의 또 다른 용도는 특정 기술의 작동원리를 배우는 것이다

### 1.2.3. 속도 저하 이유를 알아낸다
- **대부분의 개발자는 속도 저하와 성능을 동일시하는 경향이 있는데, 실은 그렇지 않다**
- 앱이 주어진 트리거에 뒤늦게 반응하는 속도 저하 현상은 성능 문제의 한 부류일 뿐이다
- 배터리가 너무 빨리 소모되는 현상도 일종의 앱성능 문제라고 볼 수 있다
- 네트워크를 통해 데이터를 전송하느라 네트워크 대역폭을 너무 많이 쓰는 것도 전형적인 성능 문제이다
- **성능 문제의 원인은 보통 프로파일러를 사용**하면 쉽게 밝혀 낼 수 있는데, 프로파일러는 어떤 코드가 실행되는지 알려줄 뿐만 아니라 커맨드별 실행 시간도 함께 표시한다
- 많은 경우 속도 저하는 파일이나 DB 에 읽기/쓰기를 하거나, 네트워크를 통해 데이터를 전송하는 등 I/O 호출을 하는 과정에서 발생한다

### 1.2.4. 앱 크래시가 발생하는 이유를 이해한다
- 앱 크래시는 사실상 거의 재현하기가 불가능하다
- 앱 크래시는 보통 2가지 형태로 일어난다
  - 앱이 완전히 멈춘다
  - 실행은 계속되지만 요청에 응답하지 않는다
- 앱이 완전히 멈춘 경우
  - 복구 불가능한 에러가 발생한 것이며, 대부분 `메모리 에러` 때문이다
  - 자바는 힙 메모리가 가득 차 앱이 더이상 작동하지 않으면 OOM 에러를 낸다
  - **힙 메모리 문제를 조사하려면 특정 시점에 힙 메모리에 어떤 데이터가 포함되어 있었는지 스냅샷에 해당하는 `힙 덤프` 를 사용한다**
    - 힙 덤프는 앱이 내부적으로 데이터를 어떻게 처리하는지 풍성한 세부 정보를 제공하는 강력한 도구이다
    - 힙 덤프는 메모리 지도 같은 것이다
- 앱이 실행되지만 요청에 응답하지 않는 경우
  - 안에서 무슨일이 일어나고 있는지 분석하는 최상의 도구인 `스레드 덤프` 를 활용한다
    - 스레드 덤프는 덤프 생성 당시 실행중이던 스레드에 관한 세부 정보를 제공한다.
    - 스레드 상태, 스택 트레이스, 이를 통해 스레드가 어떤 코드를 실행 중이엇는지, 무엇 때문에 스레드가 차단되는지 확인할 수 있다